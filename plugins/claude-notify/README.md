# Claude Notify

A floating notification panel for Claude Code, built with [Hammerspoon](https://www.hammerspoon.org/).

Replaces macOS notification center stacking with a single always-on-top mini-window that accumulates notifications. Click any notification to jump directly to that terminal/tmux session.

## Features

- **Dark / Light theme** with one-click toggle in Settings
- **Toast banner** slides down from top of screen on new notification (auto-dismiss after 4s)
- **Contextual messages** - parses Claude Code hook context for meaningful notifications (e.g. "Approval needed", "Task completed") instead of generic text
- Click notification to focus the correct terminal / tmux pane
- Filter by type: All / IN (input needed) / OK (response complete)
- Read/unread status tracking (pulsing blue dot + accent border)
- New notification flash animation
- Adjustable opacity and font size sliders
- Resizable window with standard minimize/close controls
- Hotkey toggle (default: Ctrl+Shift+N)
- Project name + tmux session tag per notification
- Works with or without tmux

## Prerequisites

- **macOS** (Hammerspoon is macOS only)
- **[Hammerspoon](https://www.hammerspoon.org/)** with CLI enabled
  - Install: `brew install --cask hammerspoon`
  - Enable CLI: Hammerspoon Preferences > Enable CLI (or run `hs.ipc.cliInstall()` in console)
- **Claude Code** with hooks support
- **python3** (for contextual message parsing; falls back to generic messages if unavailable)
- **tmux** (optional, for session navigation)

## Quick Start

```bash
# Clone the repo
git clone https://github.com/JeonJe/claude-plugins.git
cd claude-plugins/plugins/claude-notify

# Run interactive setup
bash setup.sh
```

The setup script will:
1. Detect Hammerspoon CLI path
2. Detect your terminal app (Ghostty, iTerm2, Terminal, WezTerm, etc.)
3. Detect tmux (optional)
4. Choose default theme (Dark / Light)
5. Ask notification language (English / Korean)
6. Configure hotkey and HTTP port
7. Copy files and generate configs
8. Print the Claude Code hook settings to add to `~/.claude/settings.json`

## How It Works

```
Claude Code Hook (Notification/Stop)
  -> bash ~/.claude/hooks/notify.sh notification|stop
    -> reads JSON context from stdin (Claude Code pipes it)
    -> python3 parses notification_type + message for contextual text
    -> captures tmux session, pane ID, project name
    -> hs -c "ClaudeNotify.push(...)"
      -> Toast banner slides down from top center of screen
      -> Hammerspoon webview panel updates
        -> Click notification or toast
          -> focuses terminal + switches tmux session/pane
```

Communication between the webview and Lua uses a local HTTP server (default port 17839). No external network calls.

## Toast Notifications

When a new notification arrives, a toast banner slides down from the top center of your screen:

- Borderless, rounded card with icon + message + project tag
- Auto-dismisses after 4 seconds
- Click to navigate to the source terminal/tmux pane
- Respects the current theme (dark/light)

## Contextual Messages

The hook script parses Claude Code's JSON context to generate meaningful messages:

| Hook Event | notification_type | Message |
|------------|-------------------|---------|
| Notification | `permission_prompt` | Tool/action name (e.g. "Read tool for src/main.ts") |
| Notification | `idle_prompt` | "Waiting for input" |
| Notification | `elicitation_dialog` | "Question pending" |
| Notification | `auth_success` | "Auth complete" |
| Stop | - | "Task completed" |

Falls back to generic messages if python3 is unavailable.

## Panel Controls

| Control | Description |
|---------|-------------|
| Badge | Unread notification count |
| All / IN / OK | Filter by notification type |
| Clear | Remove all notifications |
| Quit | Close panel and stop HTTP server |
| Settings > Theme | Toggle Dark / Light theme |
| Settings > Opacity | Adjust panel opacity (10-100%) |
| Settings > Font | Adjust font size (10-20px) |

## File Structure

After setup, files are placed in:

```
~/.hammerspoon/
  claude-notify.lua           # Main notification panel module
  claude-notify-config.lua    # Your config (generated by setup)
  init.lua                    # Add require("claude-notify") here

~/.claude/
  hooks/
    notify.sh                 # Claude Code hook script (contextual messages)
    notify-config.sh          # Hook config (generated by setup)
  settings.json               # Add Notification/Stop hooks here
```

## Configuration

All settings are in `~/.hammerspoon/claude-notify-config.lua`:

```lua
return {
    terminal = "Ghostty",           -- Your terminal app name
    hs_path = "/opt/homebrew/bin/hs",
    tmux_path = "/opt/homebrew/bin/tmux",
    use_tmux = true,                -- Enable tmux pane navigation
    port = 17839,                   -- HTTP callback port
    hotkey_mods = { "ctrl", "shift" },
    hotkey_key = "n",
    lang = "en",                    -- "en" or "ko"
    theme = "dark",                 -- "dark" or "light"
    panel = {
        width = 320,
        height = 420,
        alpha = 0.93,
        always_on_top = true,
    },
}
```

Re-run `bash setup.sh` to regenerate configs, or edit the file directly and reload Hammerspoon.

## Troubleshooting

| Problem | Solution |
|---------|----------|
| `hs` command not found | Enable CLI in Hammerspoon Preferences, or run `hs.ipc.cliInstall()` in console |
| Panel doesn't appear | Check `~/.hammerspoon/init.lua` has `require("hs.ipc")` and `ClaudeNotify = require("claude-notify")` |
| Click doesn't navigate | Verify tmux is running and `use_tmux = true` in config |
| Port conflict | Change `port` in both `claude-notify-config.lua` and `notify-config.sh`, or re-run setup |
| Generic messages instead of contextual | Ensure `python3` is available in PATH |
| Toast not showing | Check that Hammerspoon has screen recording permission (System Settings > Privacy) |

## Note

This plugin uses Hammerspoon instead of the standard Claude Code skill pattern. It is installed via `bash setup.sh` rather than `/plugin install`.

## License

MIT
